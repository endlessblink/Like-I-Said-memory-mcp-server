<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task-Subtask-Memory Workflow Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mermaid {
            text-align: center;
        }
        .description {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .code-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>Task-Subtask-Memory Workflow Visualization</h1>
    
    <div class="description">
        <p>This page provides interactive visual diagrams showing how tasks, subtasks, and memories interact in the Like-I-Said MCP server.</p>
    </div>

    <h2>1. System Architecture Overview</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TB
    %% Main Components
    subgraph "MCP Client Layer"
        CLIENT[Claude/IDE Client]
    end
    
    subgraph "MCP Server Tools"
        CREATE[create_task<br/>‚ú® Creates new tasks]
        UPDATE[update_task<br/>üìù Updates status/subtasks]
        LIST[list_tasks<br/>üìã Lists with filters]
        GET_CTX[get_task_context<br/>üîç Gets full context]
        ADD_MEM[add_memory<br/>üíæ Stores memories]
        SEARCH[search_memories<br/>üîé Finds memories]
    end
    
    subgraph "Core Processing"
        TS[TaskStorage<br/>üì¶ Manages tasks]
        MS[MemoryStorage<br/>üß† Manages memories]
        TML[TaskMemoryLinker<br/>üîó Auto-links content]
        VS[VectorStorage<br/>üéØ Semantic search]
    end
    
    subgraph "File Storage"
        TASKS[(Tasks Directory<br/>üìÅ /tasks/project/)]
        MEMS[(Memories Directory<br/>üìÅ /memories/project/)]
    end
    
    %% Connections
    CLIENT ==>|MCP Protocol| CREATE
    CLIENT ==>|MCP Protocol| UPDATE
    CLIENT ==>|MCP Protocol| ADD_MEM
    
    CREATE --> TS
    UPDATE --> TS
    ADD_MEM --> MS
    
    TS <--> TML
    MS <--> TML
    TML <--> VS
    
    TS --> TASKS
    MS --> MEMS
    
    style CLIENT fill:#3498db,stroke:#2c3e50,stroke-width:3px,color:#fff
    style TML fill:#e74c3c,stroke:#c0392b,stroke-width:3px,color:#fff
    style VS fill:#9b59b6,stroke:#8e44ad,stroke-width:3px,color:#fff
        </div>
    </div>

    <h2>2. Task Creation with Auto-Linking Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant User
    participant MCP as MCP Server
    participant TS as TaskStorage
    participant TML as TaskMemoryLinker
    participant MS as MemoryStorage
    participant VS as VectorStorage
    participant FS as File System
    
    User->>MCP: create_task("Implement API", project="app")
    activate MCP
    
    MCP->>TS: saveTask(task)
    activate TS
    
    Note over TS: Generate ID: task-2025-01-31-abc123<br/>Generate Serial: TASK-00042<br/>Enhance Title: "Implement REST API endpoints"
    
    TS->>TML: autoLinkMemories(task)
    activate TML
    
    par Keyword Search
        TML->>MS: findCandidateMemories()
        MS-->>TML: Found 15 keyword matches
    and Semantic Search
        TML->>VS: findSemanticCandidates()
        VS-->>TML: Found 8 semantic matches
    end
    
    Note over TML: Combined: 20 unique candidates<br/>Scored by relevance factors<br/>Filtered: 5 with score > 0.3
    
    TML-->>TS: 5 memory_connections
    deactivate TML
    
    TS->>FS: Write to /tasks/app/tasks.md
    FS-->>TS: ‚úì Saved
    
    TS-->>MCP: Task created with 5 linked memories
    deactivate TS
    
    MCP-->>User: ‚úÖ Task TASK-00042 created
    deactivate MCP
        </div>
    </div>

    <h2>3. Task-Subtask Relationship Structure</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "Main Task"
        MT[<b>Build Authentication System</b><br/>ID: task-2025-01-31-main<br/>Status: in_progress<br/>Subtasks: 3]
    end
    
    subgraph "Subtasks"
        ST1[<b>Create JWT tokens</b><br/>ID: task-2025-01-31-jwt<br/>Status: done ‚úÖ<br/>Parent: main]
        ST2[<b>Add password hashing</b><br/>ID: task-2025-01-31-hash<br/>Status: in_progress üîÑ<br/>Parent: main]
        ST3[<b>Session management</b><br/>ID: task-2025-01-31-session<br/>Status: todo üìã<br/>Parent: main]
    end
    
    subgraph "Linked Memories"
        M1[JWT Best Practices<br/>Relevance: 0.92]
        M2[bcrypt Implementation<br/>Relevance: 0.85]
        M3[Session Security Guide<br/>Relevance: 0.78]
        M4[Auth Architecture<br/>Relevance: 0.81]
    end
    
    MT ==>|subtasks array| ST1
    MT ==>|subtasks array| ST2
    MT ==>|subtasks array| ST3
    
    ST1 -.->|parent_task| MT
    ST2 -.->|parent_task| MT
    ST3 -.->|parent_task| MT
    
    ST1 --> M1
    ST2 --> M2
    ST3 --> M3
    MT --> M4
    
    style MT fill:#3498db,stroke:#2c3e50,stroke-width:3px,color:#fff
    style ST1 fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff
    style ST2 fill:#f39c12,stroke:#d68910,stroke-width:2px,color:#fff
    style ST3 fill:#95a5a6,stroke:#7f8c8d,stroke-width:2px,color:#fff
        </div>
    </div>

    <h2>4. Memory Auto-Linking Scoring Process</h2>
    <div class="diagram-container">
        <div class="mermaid">
flowchart LR
    subgraph "Input"
        TASK[New Task:<br/>"Fix API authentication bug"]
    end
    
    subgraph "Search Phase"
        KEY[Keyword Search<br/>Finds: 25 memories]
        SEM[Semantic Search<br/>Finds: 15 memories]
    end
    
    subgraph "Scoring Factors"
        F1[Semantic: 40%<br/>üéØ 0.85 match]
        F2[Project: 25%<br/>‚úÖ Same project]
        F3[Category: 15%<br/>‚úÖ Both 'code']
        F4[Tags: 15%<br/>üìå 2/3 match]
        F5[Keywords: 10%<br/>üî§ 5 matches]
        F6[Time: 8%<br/>üìÖ Same week]
    end
    
    subgraph "Results"
        SCORE[Total Score: 0.82<br/>‚úÖ Above 0.3 threshold]
        LINK[Created Connection:<br/>Type: bug_fix<br/>Relevance: 0.82]
    end
    
    TASK --> KEY
    TASK --> SEM
    
    KEY --> F1
    SEM --> F1
    
    F1 --> SCORE
    F2 --> SCORE
    F3 --> SCORE
    F4 --> SCORE
    F5 --> SCORE
    F6 --> SCORE
    
    SCORE --> LINK
    
    style TASK fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff
    style SCORE fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff
    style LINK fill:#3498db,stroke:#2c3e50,stroke-width:2px,color:#fff
        </div>
    </div>

    <h2>5. Task Status Lifecycle</h2>
    <div class="diagram-container">
        <div class="mermaid">
stateDiagram-v2
    [*] --> todo: Task Created
    
    todo --> in_progress: Start Work<br/>update_task(status: "in_progress")
    
    in_progress --> done: Complete<br/>‚úÖ All subtasks done<br/>üìù Completion memory created
    
    in_progress --> blocked: Hit Obstacle<br/>‚ùå Add blocking reason<br/>üîó Link relevant memories
    
    blocked --> in_progress: Unblocked<br/>‚úì Issue resolved
    
    blocked --> todo: Reset<br/>‚Ü©Ô∏è Start over
    
    done --> [*]: Archived
    
    note right of done
        Completion triggers:
        ‚Ä¢ Update subtask statuses
        ‚Ä¢ Create completion memory
        ‚Ä¢ Update linked memories
        ‚Ä¢ Calculate metrics
    end note
    
    note left of blocked
        When blocked:
        ‚Ä¢ Document reason
        ‚Ä¢ Find related issues
        ‚Ä¢ Notify dependencies
        ‚Ä¢ Suggest solutions
    end note
        </div>
    </div>

    <h2>6. Real-World Example Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TB
    subgraph "1. User Creates Task"
        U1[User: "Create task to fix login bug"]
    end
    
    subgraph "2. Task Processing"
        T1[Task Created<br/>ID: task-2025-01-31-fix123<br/>Title: "Fix user login authentication bug"]
        AUTO[Auto-Linking Activated]
    end
    
    subgraph "3. Memory Discovery"
        SEARCH[Search Memories]
        M1[Found: "Login implementation"<br/>Score: 0.89]
        M2[Found: "JWT token fix"<br/>Score: 0.76]
        M3[Found: "Auth error handling"<br/>Score: 0.71]
        M4[Found: "Session timeout"<br/>Score: 0.45]
        M5[Found: "User permissions"<br/>Score: 0.28 ‚ùå]
    end
    
    subgraph "4. Final Task"
        FINAL[Task TASK-00123<br/>Status: todo<br/>Memories: 4 linked<br/>Ready to start]
    end
    
    U1 --> T1
    T1 --> AUTO
    AUTO --> SEARCH
    
    SEARCH --> M1
    SEARCH --> M2
    SEARCH --> M3
    SEARCH --> M4
    SEARCH --> M5
    
    M1 -->|Above 0.3| FINAL
    M2 -->|Above 0.3| FINAL
    M3 -->|Above 0.3| FINAL
    M4 -->|Above 0.3| FINAL
    M5 -.->|Below 0.3| X[Rejected]
    
    style U1 fill:#3498db,stroke:#2c3e50,stroke-width:2px,color:#fff
    style AUTO fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff
    style FINAL fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff
    style M5 fill:#e8e8e8,stroke:#999,stroke-width:1px,color:#666
        </div>
    </div>

    <div class="description">
        <h3>Key Insights:</h3>
        <ul>
            <li><strong>Automatic Linking:</strong> When you create a task, the system automatically finds and links relevant memories based on multiple factors</li>
            <li><strong>Scoring System:</strong> Each memory is scored from 0-1, with only scores above 0.3 being linked</li>
            <li><strong>Bidirectional:</strong> Tasks know about their memories, and memories know about their tasks</li>
            <li><strong>Subtask Hierarchy:</strong> Subtasks are full tasks with parent references, enabling complex project management</li>
            <li><strong>Status Workflow:</strong> Tasks follow a clear lifecycle with automation at each transition</li>
        </ul>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#3498db',
                primaryTextColor: '#fff',
                primaryBorderColor: '#2c3e50',
                lineColor: '#34495e',
                secondaryColor: '#e74c3c',
                tertiaryColor: '#f39c12'
            }
        });
    </script>
</body>
</html>